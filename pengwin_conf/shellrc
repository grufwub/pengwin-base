# enable external x display
export DISPLAY=:0

# enable external libgl
export LIBGL_ALWAYS_INDIRECT=1

# speed up some GUI apps like gedit
export NO_AT_BRIDGE=1

# Fix 'clear' scrolling issues
alias clear='clear -x'

# Custom aliases
alias ll='ls -al'

# Check if we have Windows Path
if ( which cmd.exe > /dev/null 2>&1 ); then

  # Execute on user's shell first-run
  if [ ! -f "$HOME/.firstrun" ]; then
    echo "Welcome to Pengwin. Type 'pengwin-setup' to run the setup tool. You will only see this message on the first run."
    touch "$HOME/.firstrun"
  fi

  if ( ! wslpath 'C:\' > /dev/null 2>&1 ); then
    alias wslpath=legacy_wslupath
  fi

  # Create a symbolic link to the windows home
  wHomeWinPath=$(cmd-exe /c 'echo %HOMEDRIVE%%HOMEPATH%' | tr -d '\r')
  export WIN_HOME=$(wslpath -u "$wHomeWinPath")
  unset wHomeWinPath

  win_home_lnk=${HOME}/winhome
  if [ ! -e "$win_home_lnk" ] ; then
    ln -sf "$WIN_HOME" "$win_home_lnk"
  fi
  unset win_home_lnk

fi

# Load global custom scripts
rc='/etc/pengwin_conf/shellrc.d'
if [ -d "$rc" ]; then
  for file in $(ls "$rc"); do
    file="$rc/$file"
    [ -r "$file" ] && . "$file"
  done
  unset file
fi
unset rc

# Load user custom scripts
user_rc="$HOME/.config/pengwin_conf/shellrc.d"
if ( test -d "$user_rc" ); then
  for file in $(ls "$user_rc"); do
    file="$user_rc/$file"
    [ -r "$file" ] && . "$file"
  done
  unset file
fi
unset user_rc