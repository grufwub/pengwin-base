# enable external x display
set -x DISPLAY=:0

# enable external libgl
set -x LIBGL_ALWAYS_INDIRECT=1

# speed up some GUI apps like gedit
set -x NO_AT_BRIDGE=1

# Fix 'clear' scrolling issues
alias clear='clear -x'

# Custom aliases
alias ll='ls -al'

# Check if we have Windows Path
if ( which cmd.exe > /dev/null )

  # (we shouldn't end up needing to do this with fish shell,
  #  but may as well leave it just in case)
  # Execute on user's shell first-run
  if ( ! test -f "$HOME/.firstrun" )
    echo "Welcome to Pengwin. Type 'pengwin-setup' to run the setup tool. You will only see this message on the first run."
    touch "$HOME/.firstrun"
  fi

  # Check if legacy install requiring legacy_wslupath
  if ( ! wslpath 'C:\' > /dev/null 2>&1 )
    alias wslpath='legacy_wslupath'
  end

  # Get Windos home dir path
  set wHomeWinPath (cmd-exe /c 'echo %HOMEDRIVE%%HOMEPATH%' | tr -d '\r')
  set -x WIN_HOME (wslpath -u "$wHomeWinPath")
  set -e wHomeWinPath

  # Setup Windows home dir symbolic link
  set win_home_lnk "$HOME/winhome"
  if ( test -e "$win_home_lnk" )
    ln -sf "$WIN_HOME" "$win_home_lnk"
  end
  set -e win_home_lnk

end

# Load user custom scripts
if ( test -d "$HOME/.config/pengwin_conf/fishrc.d" )
  for file in "$HOME/.config/pengwin_conf/fishrc.d"
    test -r "$file" && . "$file"
  end

  set -e file
end